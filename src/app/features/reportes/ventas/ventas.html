<div class="ventas-report">
  @if (loading()) {
  <app-loading message="Cargando reporte..." />
  } @else if (error()) {
  <app-error-message [title]="'Error'" [message]="error()!" (retry)="onRetry()" />
  } @else {
  <!-- Filtros -->
  <p-card header="Filtros" styleClass="filtros-card">
    <form [formGroup]="filtrosForm" class="filtros-form">
      <div class="field">
        <p-floatLabel>
          <p-datepicker formControlName="fechaInicio" [showIcon]="true" inputId="fechaInicio" dateFormat="yy-mm-dd" />
          <label for="fechaInicio">Fecha Inicio</label>
        </p-floatLabel>
      </div>

      <div class="field">
        <p-floatLabel>
          <p-datepicker formControlName="fechaFin" [showIcon]="true" inputId="fechaFin" dateFormat="yy-mm-dd" />
          <label for="fechaFin">Fecha Fin</label>
        </p-floatLabel>
      </div>

      <div class="field">
        <p-floatLabel>
          <p-select [options]="periodos" formControlName="periodo" optionLabel="label" optionValue="value"
            inputId="periodo" [style]="{'width':'100%'}" />
          <label for="periodo">Período</label>
        </p-floatLabel>
      </div>

      <div class="actions">
        <p-button label="Consultar" icon="pi pi-search" (click)="cargarDatos()" />
        <p-button label="Exportar" icon="pi pi-download" severity="secondary" (click)="exportar()" />
      </div>
    </form>
  </p-card>

  <!-- Resumen -->
  <div class="resumen-grid">
    <p-card styleClass="stat-card">
      <div class="stat-content">
        <div class="stat-icon valor">
          <i class="pi pi-dollar"></i>
        </div>
        <div class="stat-info">
          <div class="stat-label">Total Ventas</div>
          <div class="stat-value">{{ totalVentas() | currency:'COP':'symbol-narrow':'1.0-0' }}</div>
        </div>
      </div>
    </p-card>

    <p-card styleClass="stat-card">
      <div class="stat-content">
        <div class="stat-icon promedio">
          <i class="pi pi-chart-line"></i>
        </div>
        <div class="stat-info">
          <div class="stat-label">Promedio</div>
          <div class="stat-value">{{ promedioVentas() | currency:'COP':'symbol-narrow':'1.0-0' }}</div>
        </div>
      </div>
    </p-card>

    <p-card styleClass="stat-card">
      <div class="stat-content">
        <div class="stat-icon registros">
          <i class="pi pi-calendar"></i>
        </div>
        <div class="stat-info">
          <div class="stat-label">Registros</div>
          <div class="stat-value">{{ ventasData().length }}</div>
        </div>
      </div>
    </p-card>
  </div>

  <!-- Gráfica -->
  <p-card header="Evolución de Ventas" styleClass="chart-card">
    <div class="chart-container">
      <p-chart type="line" [data]="lineChartData" [options]="lineChartOptions" height="400px" />
    </div>
  </p-card>
  }
</div>