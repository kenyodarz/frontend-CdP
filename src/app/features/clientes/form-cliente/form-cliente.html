<div class="form-cliente-container">
  <p-toast />
  @if (loading()) {
  <app-loading message="Cargando..." />
  } @else if (error()) {
  <app-error-message [title]="'Error'" [message]="error()!" (retry)="onRetry()" />
  } @else {
  <div class="form-header">
    <h2>{{ isEditMode() ? 'Editar Cliente' : 'Nuevo Cliente' }}</h2>
    <p-button icon="pi pi-times" [rounded]="true" [text]="true" (onClick)="cancelar()" pTooltip="Cerrar" />
  </div>

  <form [formGroup]="clienteForm" (ngSubmit)="onSubmit()">
    <p-card header="Información General">
      <div class="form-grid">
        <!-- Código -->
        <div class="field">
          <p-floatLabel>
            <input pInputText id="codigo" formControlName="codigo" />
            <label for="codigo">Código</label>
          </p-floatLabel>
          <small class="hint">Ej: CLI001</small>
        </div>

        <!-- Nombre -->
        <div class="field full-width">
          <p-floatLabel>
            <input pInputText id="nombre" formControlName="nombre" />
            <label for="nombre">Nombre *</label>
          </p-floatLabel>
          @if (clienteForm.get('nombre')?.hasError('required') && clienteForm.get('nombre')?.touched) {
          <small class="p-error">El nombre es requerido</small>
          }
          @if (clienteForm.get('nombre')?.hasError('minlength')) {
          <small class="p-error">Mínimo 3 caracteres</small>
          }
        </div>

        <!-- Tipo de Documento -->
        <div class="field">
          <p-floatLabel>
            <p-select [options]="tiposDocumento" formControlName="tipoDocumento" optionLabel="label" optionValue="value"
              inputId="tipoDocumento" [style]="{'width':'100%'}" />
            <label for="tipoDocumento">Tipo de Documento</label>
          </p-floatLabel>
        </div>

        <!-- Número de Documento -->
        <div class="field">
          <p-floatLabel>
            <input pInputText id="numeroDocumento" formControlName="numeroDocumento" />
            <label for="numeroDocumento">Número de Documento</label>
          </p-floatLabel>
        </div>

        <!-- Teléfono -->
        <div class="field">
          <p-floatLabel>
            <input pInputText id="telefono" formControlName="telefono" />
            <label for="telefono">Teléfono</label>
          </p-floatLabel>
          <small class="hint">Ej: 3001234567</small>
        </div>

        <!-- Tipo de Negocio -->
        <div class="field">
          <p-floatLabel>
            <input pInputText id="tipoNegocio" formControlName="tipoNegocio" />
            <label for="tipoNegocio">Tipo de Negocio</label>
          </p-floatLabel>
          <small class="hint">Ej: Tienda, Supermercado</small>
        </div>
      </div>
    </p-card>

    <p-card header="Ubicación">
      <div class="form-grid">
        <!-- Dirección -->
        <div class="field full-width">
          <p-floatLabel>
            <input pInputText id="direccion" formControlName="direccion" />
            <label for="direccion">Dirección</label>
          </p-floatLabel>
        </div>

        <!-- Barrio -->
        <div class="field">
          <p-floatLabel>
            <input pInputText id="barrio" formControlName="barrio" />
            <label for="barrio">Barrio</label>
          </p-floatLabel>
        </div>

        <!-- Comuna -->
        <div class="field">
          <p-floatLabel>
            <input pInputText id="comuna" formControlName="comuna" />
            <label for="comuna">Comuna</label>
          </p-floatLabel>
        </div>
      </div>
    </p-card>

    <p-card header="Configuración Comercial">
      <div class="form-grid">
        <!-- Tipo de Tarifa -->
        <div class="field">
          <p-floatLabel>
            <p-select [options]="tiposTarifa" formControlName="tipoTarifa" optionLabel="label" optionValue="value"
              inputId="tipoTarifa" [style]="{'width':'100%'}" />
            <label for="tipoTarifa">Tipo de Tarifa *</label>
          </p-floatLabel>
          @if (clienteForm.get('tipoTarifa')?.hasError('required') && clienteForm.get('tipoTarifa')?.touched) {
          <small class="p-error">El tipo de tarifa es requerido</small>
          }
        </div>

        <!-- Horario de Entrega -->
        <div class="field">
          <p-floatLabel>
            <input pInputText id="horarioEntrega" formControlName="horarioEntrega" />
            <label for="horarioEntrega">Horario de Entrega</label>
          </p-floatLabel>
          <small class="hint">Ej: 8:00 AM - 12:00 PM</small>
        </div>
      </div>
    </p-card>

    <div class="form-actions">
      <p-button label="Cancelar" icon="pi pi-times" [text]="true" (onClick)="cancelar()" />
      <p-button label="{{ isEditMode() ? 'Actualizar' : 'Crear' }} Cliente" icon="pi pi-save" type="submit"
        [loading]="loading()" />
    </div>
  </form>
  }
</div>