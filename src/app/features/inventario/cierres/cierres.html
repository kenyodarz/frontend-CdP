<div class="cierres-container">
  <p-toast></p-toast>

  <p-card header="Cierres de Inventario">
    <!-- Ejecutar Cierre -->
    <div class="cierre-actions">
      <div class="periodo-selector">
        <label for="periodo">Período:</label>
        <input type="month" id="periodo" [(ngModel)]="periodoSeleccionado" class="p-inputtext p-component"
          (change)="cargarCierres()">
      </div>

      <p-button label="Ejecutar Cierre Mensual" icon="pi pi-check-circle" (onClick)="ejecutarCierre()"
        [loading]="ejecutandoCierre" severity="success">
      </p-button>

      <p-button label="Actualizar" icon="pi pi-refresh" (onClick)="cargarCierres()" [loading]="loading"
        severity="secondary">
      </p-button>
    </div>

    <!-- Historial de Cierres -->
    <div class="cierres-table">
      <h3>Historial de Cierres</h3>

      <p-table [value]="cierres" [loading]="loading" [paginator]="true" [rows]="10" [showCurrentPageReport]="true"
        currentPageReportTemplate="Mostrando {first} a {last} de {totalRecords} cierres"
        [rowsPerPageOptions]="[10, 25, 50]" styleClass="p-datatable-sm">

        <ng-template pTemplate="header">
          <tr>
            <th pSortableColumn="periodo">Período <p-sortIcon field="periodo"></p-sortIcon></th>
            <th pSortableColumn="nombreProducto">Producto <p-sortIcon field="nombreProducto"></p-sortIcon></th>
            <th>Stock Inicial</th>
            <th>Entradas</th>
            <th>Salidas</th>
            <th>Stock Final</th>
            <th pSortableColumn="fechaCierre">Fecha Cierre <p-sortIcon field="fechaCierre"></p-sortIcon></th>
            <th>Estado</th>
          </tr>
        </ng-template>

        <ng-template pTemplate="body" let-cierre>
          <tr>
            <td>{{ cierre.periodo }}</td>
            <td><strong>{{ cierre.nombreProducto || 'Producto #' + cierre.idProducto }}</strong></td>
            <td>{{ cierre.stockInicial }}</td>
            <td class="text-success">+{{ cierre.totalEntradas }}</td>
            <td class="text-danger">-{{ cierre.totalSalidas }}</td>
            <td><strong>{{ cierre.stockFinal }}</strong></td>
            <td>{{ cierre.fechaCierre | date:'short' }}</td>
            <td>
              <p-tag [value]="cierre.estado" [severity]="getSeverity(cierre.estado)">
              </p-tag>
            </td>
          </tr>
        </ng-template>

        <ng-template pTemplate="emptymessage">
          <tr>
            <td colspan="8" class="text-center">
              No hay cierres para este período
            </td>
          </tr>
        </ng-template>
      </p-table>
    </div>
  </p-card>
</div>