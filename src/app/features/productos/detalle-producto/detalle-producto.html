<div class="detalle-producto-container">
  @if (loading()) {
  <app-loading message="Cargando producto..." />
  } @else if (error()) {
  <app-error-message [title]="'Error al cargar producto'" [message]="error()!" (retry)="onRetry()" />
  } @else if (producto(); as prod) {
  <div class="header">
    <div class="title-section">
      <button mat-icon-button (click)="volver()" matTooltip="Volver">
        <mat-icon>arrow_back</mat-icon>
      </button>
      <h2>{{ prod.nombre }}</h2>
    </div>
    <div class="actions">
      <button mat-raised-button color="primary" (click)="editar()">
        <mat-icon>edit</mat-icon>
        Editar
      </button>
      <button mat-raised-button color="warn" (click)="desactivar()" [disabled]="prod.estado === 'INACTIVO'">
        <mat-icon>block</mat-icon>
        Desactivar
      </button>
    </div>
  </div>

  <div class="content-grid">
    <!-- Información General -->
    <mat-card>
      <mat-card-header>
        <mat-card-title>Información General</mat-card-title>
      </mat-card-header>
      <mat-card-content>
        <div class="info-grid">
          <div class="info-item">
            <span class="label">Código:</span>
            <span class="value">{{ prod.codigo || '-' }}</span>
          </div>
          <div class="info-item">
            <span class="label">Nombre:</span>
            <span class="value"><strong>{{ prod.nombre }}</strong></span>
          </div>
          <div class="info-item full-width">
            <span class="label">Descripción:</span>
            <span class="value">{{ prod.descripcion || '-' }}</span>
          </div>
          <div class="info-item">
            <span class="label">Categoría:</span>
            <span class="value">{{ prod.categoria.nombre }}</span>
          </div>
          <div class="info-item">
            <span class="label">Unidad de Medida:</span>
            <span class="value">{{ prod.unidadMedida.nombre }}</span>
          </div>
          <div class="info-item">
            <span class="label">Estado:</span>
            <mat-chip [class.estado-activo]="prod.estado === 'ACTIVO'"
              [class.estado-inactivo]="prod.estado === 'INACTIVO'">
              {{ prod.estado }}
            </mat-chip>
          </div>
        </div>
      </mat-card-content>
    </mat-card>

    <!-- Inventario -->
    <mat-card>
      <mat-card-header>
        <mat-card-title>Inventario</mat-card-title>
      </mat-card-header>
      <mat-card-content>
        <div class="info-grid">
          <div class="info-item">
            <span class="label">Stock Actual:</span>
            <mat-chip [class.stock-bajo]="getStockStatus() === 'bajo'" [class.stock-alto]="getStockStatus() === 'alto'"
              [class.stock-normal]="getStockStatus() === 'normal'">
              {{ prod.stockActual }}
            </mat-chip>
          </div>
          <div class="info-item">
            <span class="label">Stock Mínimo:</span>
            <span class="value">{{ prod.stockMinimo }}</span>
          </div>
          <div class="info-item">
            <span class="label">Stock Máximo:</span>
            <span class="value">{{ prod.stockMaximo || '-' }}</span>
          </div>
          <div class="info-item">
            <span class="label">Requiere Lote:</span>
            <span class="value">{{ prod.requiereLote ? 'Sí' : 'No' }}</span>
          </div>
          @if (prod.requiereLote && prod.diasVidaUtil) {
          <div class="info-item">
            <span class="label">Días de Vida Útil:</span>
            <span class="value">{{ prod.diasVidaUtil }} días</span>
          </div>
          }
        </div>
      </mat-card-content>
    </mat-card>

    <!-- Precios -->
    <mat-card class="full-width">
      <mat-card-header>
        <mat-card-title>Precios por Tipo de Tarifa</mat-card-title>
      </mat-card-header>
      <mat-card-content>
        <div class="precios-grid">
          @for (precio of prod.precios; track precio.idPrecio) {
          <div class="precio-card">
            <div class="precio-label">{{ getTarifaLabel(precio.tipoTarifa) }}</div>
            <div class="precio-value">{{ precio.precio | currency:'COP':'symbol-narrow':'1.0-0' }}</div>
          </div>
          }
        </div>
      </mat-card-content>
    </mat-card>

    <!-- Imagen (si existe) -->
    @if (prod.imagenUrl) {
    <mat-card>
      <mat-card-header>
        <mat-card-title>Imagen</mat-card-title>
      </mat-card-header>
      <mat-card-content>
        <img [src]="prod.imagenUrl" [alt]="prod.nombre" class="producto-imagen">
      </mat-card-content>
    </mat-card>
    }
  </div>
  }
</div>