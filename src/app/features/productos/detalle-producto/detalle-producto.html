<div class="detalle-producto-container">
  @if (loading()) {
  <app-loading message="Cargando producto..." />
  } @else if (error()) {
  <app-error-message [title]="'Error al cargar producto'" [message]="error()!" (retry)="onRetry()" />
  } @else if (producto(); as prod) {
  <div class="header">
    <div class="title-section">
      <p-button icon="pi pi-arrow-left" [rounded]="true" [text]="true" (onClick)="volver()" pTooltip="Volver" />
      <h2>{{ prod.nombre }}</h2>
    </div>
    <div class="actions">
      <p-button label="Editar" icon="pi pi-pencil" (onClick)="editar()" />
    </div>
  </div>

  <div class="content-grid">
    <!-- Información General -->
    <p-card header="Información General">
      <div class="info-grid">
        <div class="info-item">
          <span class="label">Código:</span>
          <span class="value">{{ prod.codigo || '-' }}</span>
        </div>
        <div class="info-item">
          <span class="label">Nombre:</span>
          <span class="value"><strong>{{ prod.nombre }}</strong></span>
        </div>
        <div class="info-item full-width">
          <span class="label">Descripción:</span>
          <span class="value">{{ prod.descripcion || '-' }}</span>
        </div>
        <div class="info-item">
          <span class="label">Categoría:</span>
          <span class="value">{{ prod.nombreCategoria || 'N/A' }}</span>
        </div>
        <div class="info-item">
          <span class="label">Unidad de Medida:</span>
          <span class="value">{{ prod.nombreUnidad || 'N/A' }}</span>
        </div>
        <div class="info-item">
          <span class="label">Estado:</span>
          <p-tag [value]="prod.estado" [severity]="getEstadoSeverity(prod.estado)" />
        </div>
      </div>
    </p-card>

    <!-- Inventario -->
    <p-card header="Inventario">
      <div class="info-grid">
        <div class="info-item">
          <span class="label">Stock Actual:</span>
          <p-tag [value]="prod.stockActual.toString()" [severity]="getStockSeverity()" />
        </div>
        <div class="info-item">
          <span class="label">Stock Mínimo:</span>
          <span class="value">{{ prod.stockMinimo }}</span>
        </div>
        <div class="info-item">
          <span class="label">Stock Máximo:</span>
          <span class="value">{{ prod.stockMaximo || '-' }}</span>
        </div>
        <div class="info-item">
          <span class="label">Requiere Lote:</span>
          <span class="value">{{ prod.requiereLote ? 'Sí' : 'No' }}</span>
        </div>
        @if (prod.requiereLote && prod.diasVidaUtil) {
        <div class="info-item">
          <span class="label">Días de Vida Útil:</span>
          <span class="value">{{ prod.diasVidaUtil }} días</span>
        </div>
        }
      </div>
    </p-card>

    <!-- Precios -->
    <p-card header="Precios por Tipo de Tarifa" styleClass="full-width">
      <div class="precios-grid">
        @for (precio of preciosArray(); track precio.tipoTarifa) {
        <div class="precio-card">
          <div class="precio-label">{{ getTarifaLabel(precio.tipoTarifa) }}</div>
          <div class="precio-value">{{ precio.precio | currency:'COP':'symbol-narrow':'1.0-0' }}</div>
        </div>
        }
      </div>
    </p-card>

    <!-- Imagen (si existe) -->
    @if (prod.imagenUrl) {
    <p-card header="Imagen">
      <img [src]="prod.imagenUrl" [alt]="prod.nombre" class="producto-imagen">
    </p-card>
    }
  </div>
  }
</div>